/*! mmdAvatar 0.0.1 2017-03-08  WaterTian */
function isMobileDevice(){if(void 0===navigator||void 0===navigator.userAgent)return!0;var a=navigator.userAgent;return!!(a.match(/iPhone/i)||a.match(/iPad/i)||a.match(/iPod/i)||a.match(/webOS/i)||a.match(/BlackBerry/i)||a.match(/Windows/i)&&a.match(/Phone/i)||a.match(/Android/i)&&a.match(/Mobile/i))}function loadComplete_initBtns(){loading.style.display="none",logBox=document.createElement("div"),logBox.style.position="absolute",logBox.style.top="80px",logBox.style.left="5px",logBox.style.width="100%",logBox.style.textAlign="left",logBox.style.fontSize="10px",logBox.style.color="#fafccb",logBox.innerHTML="一指旋转<br>二指缩进<br>三指移动<br>",container.appendChild(logBox),TY.logBox=logBox,stats=new Stats,container.appendChild(stats.dom);var a=document.createElement("div");a.style.position="absolute",a.style.top="20px",a.style.width="98%",a.style.textAlign="right",a.innerHTML='<input type="button" onclick="toPlay();" value="Play" />\t                     <input type="button" onclick="addOutlineEffect();" value="OutlineEffect" />\t                     <input type="button" onclick="addPhysics();" value="Physics" />',container.appendChild(a)}function init(){function a(){k.loadVmds(j,function(a){for(var c=a,d=0;d<c.length;d++)k.pourVmdIntoModel(mesh,c[d]);avatar.TYsetAnimation(mesh),avatar.TYsetikSolver(mesh),b(),loadComplete_initBtns()},g,h)}function b(){function a(){setTimeout(a,400),b.updateMorph()}var b=new TY.AvatarControler(avatar);b.logMorphString(),a()}container=document.createElement("div"),document.body.appendChild(container),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),scene=new THREE.Scene;var c=new THREE.AmbientLight(6710886);scene.add(c);var d=new THREE.DirectionalLight(8943462);d.position.set(-1,1,1).normalize(),scene.add(d);var e=new THREE.MeshPhongMaterial({color:13350911,emissive:7538991,side:THREE.BackSide});sky=new THREE.Mesh(new THREE.SphereGeometry(100,3,3),e),scene.add(sky);var f=new THREE.PolarGridHelper(20,5,14,5,16448715,16567296);f.position.y=-10,scene.add(f),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(new THREE.Color(16777215)),container.appendChild(renderer.domElement),TY.effect=new THREE.OutlineEffect(renderer),TY.effect.enabled=!1,controls=new THREE.OrbitControls(camera,renderer.domElement),controls.target.set(0,3,0),camera.position.set(0,10,30),controls.update(),loading=document.createElement("div"),loading.style.position="absolute",loading.style.top="200px",loading.style.width="100%",loading.style.textAlign="center",loading.style.fontSize="20px",loading.style.color="#fafccb",loading.innerHTML="Loading..",container.appendChild(loading);var g=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100,c="loading "+Math.round(b,2);console.log(c),loading.innerHTML=c}},h=function(a){},i="models/H5shuchu/nande.pmx",j=["models/H5shuchu/01.vmd","models/H5shuchu/02.vmd","models/H5shuchu/03.vmd","models/H5shuchu/04.vmd","models/H5shuchu/05.vmd","models/H5shuchu/06.vmd","models/H5shuchu/07.vmd"];avatar=new TY.MMDAvatar(scene);var k=new THREE.MMDLoader;k.loadModel(i,function(b){avatar.add(b),mesh=avatar.mesh,mesh.position.y=-10,avatar.initIk(),avatar.initPhysic(),avatar.enablePhysics(!1),a()},g,h),window.addEventListener("resize",onWindowResize,!1)}function initPlayer(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");isMobileDevice()?b.src="./libs/7.7.4/provider.html5.js":b.src="./libs/7.7.4/provider.caterpillar.js",a.appendChild(b);var c=document.createElement("div");document.body.appendChild(c),player=jwplayer(c),player.setup({file:"http://101.201.107.35:9380/913.m3u8",hlshtml:!0,height:100,width:300}),player.on("ready",function(){TY.logBox.innerHTML+="ready<br>"}),player.on("meta",function(a){var b=a.metadata.PRIV,c=Object.keys(b)[0],d=TY.base64decode(c),e=(TY.toUnicodeArr(d),TY.toUnicodeObj(d));TY.data=e,TY.logBox.innerHTML=TY.data+"<br>"}),console.log("initPlayer")}function toPlay(){player.play(),TY.logBox.innerHTML+="play<br>"}function addOutlineEffect(){TY.effect.enabled=!TY.effect.enabled,TY.logBox.innerHTML+="Outline-"+TY.effect.enabled+"<br>"}function addPhysics(){avatar.doPhysics?avatar.enablePhysics(!1):avatar.enablePhysics(!0),TY.logBox.innerHTML+="Physics-"+avatar.doPhysics+"<br>"}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),TY.effect.setSize(window.innerWidth,window.innerHeight)}function animate(a){requestAnimationFrame(animate),render(),TWEEN.update(a),stats&&stats.update()}function render(){void 0!==avatar&&avatar.animate(clock.getDelta()),TY.effect.render(scene,camera)}this.TY=this.TY||{},TY.VERSION="0",TY.Debug=0,TY.datas=[{1:100,34:100},{2:100,17:100},{2:30,17:100,18:100},{2:30,17:20,18:20,19:100},{12:30,13:100},{12:100,9:100},{13:100,10:100},{35:100,1:100},{35:200,2:100},{36:200,3:100},{37:100,4:100},{37:200,35:200,5:100},{35:20,36:200}],TY.data={},TY.morphConifg={length:34,1:"Blink_L",2:"Blink_R",3:"Blink",4:"BrowDown",5:"BrowUp_L",6:"BrowUp_R",7:"BrowUp",8:"MouthOpen",9:"Grin_L",10:"Grin_R",11:"Grin",12:"Crooked mouth_L",13:"Crooked mouth_R",14:"Pout",15:"Sniff",16:"EyesUP",17:"EyesDown",18:"EyesLeft",19:"EyesRight",20:"TongueOut1",21:"TongueOut2",22:"TongueOut3",23:"Mouth_A",24:"Mouth_B",25:"Mouth_U",26:"Mouth_O",27:"Mouth_E",28:"UpperLip",29:"LowerLip",30:"Shrink mouth",31:"N_Half open mouth_Up",32:"N_Half open mouth_Down",33:"Shrink mouth_L",34:"Shrink mouth_R"},TY.inherit=function(a,b){a.superClass=b,a.prototype=Object.create(b.prototype),a.prototype.constructor=a},TY.extend=function(a,b){if(!b||"object"!=typeof b)return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a},TY.dpr=window.devicePixelRatio||1,TY.isAndroid=/Android/i.test(navigator.userAgent),TY.isIphone=/iphone/i.test(navigator.userAgent),TY.isChrome=/chrome\//i.test(navigator.userAgent),TY.isWeixin=/MicroMessenger\//i.test(navigator.userAgent),TY.isWeibo=/Weibo/i.test(navigator.userAgent),TY.isMobileDevice=isMobileDevice,TY.toObject=function(a){for(var b={},c=0;c<a.length;++c)b[c]=a[c];return b},TY.toUnicodeArr=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b},TY.toUnicodeObj=function(a){for(var b={},c=0;c<a.length-1;c+=2)_id=a.charCodeAt(c),_vl=a.charCodeAt(c+1),b[_id]=_vl;return b.length=a.length/2,b};var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);TY.base64encode=function(a){var b,c,d,e,f,g;for(d=a.length,c=0,b="";c<d;){if(e=255&a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2|(192&g)>>6),b+=base64EncodeChars.charAt(63&g)}return b},TY.base64decode=function(a){var b,c,d,e,f,g,h;for(g=a.length,f=0,h="";f<g;){do b=base64DecodeChars[255&a.charCodeAt(f++)];while(f<g&&b==-1);if(b==-1)break;do c=base64DecodeChars[255&a.charCodeAt(f++)];while(f<g&&c==-1);if(c==-1)break;h+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return h;d=base64DecodeChars[d]}while(f<g&&d==-1);if(d==-1)break;h+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return h;e=base64DecodeChars[e]}while(f<g&&e==-1);if(e==-1)break;h+=String.fromCharCode((3&d)<<6|e)}return h},TY.utf16to8=function(a){var b,c,d,e;for(b="",d=a.length,c=0;c<d;c++)e=a.charCodeAt(c),e>=1&&e<=127?b+=a.charAt(c):e>2047?(b+=String.fromCharCode(224|e>>12&15),b+=String.fromCharCode(128|e>>6&63),b+=String.fromCharCode(128|e>>0&63)):(b+=String.fromCharCode(192|e>>6&31),b+=String.fromCharCode(128|e>>0&63));return b},TY.utf8to16=function(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;c<d;)switch(e=a.charCodeAt(c++),e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=a.charAt(c-1);break;case 12:case 13:f=a.charCodeAt(c++),b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a.charCodeAt(c++),g=a.charCodeAt(c++),b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b},TY.EventDispatcher=function(){},TY.EventDispatcher.prototype={constructor:TY.EventDispatcher,addEventListener:function(a,b){return this._listeners?this.removeEventListener(a,b):this._listeners={},this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push(b),b},hasEventListener:function(a,b){var c=this._listeners;return!(!c||!c[a])},removeEventListener:function(a,b){if(this._listeners&&this._listeners[a])for(var c=this._listeners[a],d=0,e=c.length;d<e;d++)if(c[d]==b){1==e?delete this._listeners[a]:c.splice(d,1);break}},removeAllEventListeners:function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},dispatchEvent:function(a,b){var c=!1,d=this._listeners;if(a&&d){var e=d[a];if(!e)return c;e=e.slice();for(var f,g=e.length;g--;){var f=e[g];c=c||f(b)}}return!!c}},TY.MMDAvatar=function(a){this.scene=a,this.mesh=null,this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null,this.ikHelper,this.physicsHelper,this.currentAction=null},TY.MMDAvatar.prototype=Object.assign(TY.EventDispatcher.prototype,{constructor:TY.MMDAvatar,add:function(a){if(!(a instanceof THREE.SkinnedMesh))throw new Error("THREE.MMDHelper.add() accepts only THREE.SkinnedMesh instance.");void 0===a.mixer&&(a.mixer=null),void 0===a.ikSolver&&(a.ikSolver=null),void 0===a.grantSolver&&(a.grantSolver=null),void 0===a.physics&&(a.physics=null),void 0===a.looped&&(a.looped=!1),this.mesh=a,this.meshes.push(a),this.initBackupBones(a),this.scene.add(this.mesh)},initIk:function(){this.ikHelper=new THREE.CCDIKHelper(this.mesh),this.ikHelper.visible=!1,this.scene.add(this.ikHelper)},initPhysic:function(){this.setPhysics(this.mesh),this.physicsHelper=new THREE.MMDPhysicsHelper(this.mesh),this.physicsHelper.visible=!1,this.scene.add(this.physicsHelper)},setAudio:function(a,b,c){this.audioManager=new THREE.MMDAudioManager(a,b,c)},setCamera:function(a){a.mixer=null,this.camera=a},setPhysicses:function(a){for(var b=0;b<this.meshes.length;b++)this.setPhysics(this.meshes[b],a)},setPhysics:function(a,b){if(b=void 0===b?{}:Object.assign({},b),void 0===b.world&&this.sharedPhysics){var c=this.getMasterPhysics();null!==c&&(b.world=c.world)}var d=void 0!==b.warmup?b.warmup:60,e=new THREE.MMDPhysics(a,b);null!==a.mixer&&void 0!==a.mixer&&b.preventAnimationWarmup!==!0&&(this.animateOneMesh(0,a),e.reset()),e.warmup(d),this.updateIKParametersDependingOnPhysicsEnabled(a,!0),a.physics=e},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var a=0,b=this.meshes.length;a<b;a++){var c=this.meshes[a].physics;if(void 0!==c&&null!==c)return this.masterPhysics=c,this.masterPhysics}return null},enablePhysics:function(a){a===!0?this.doPhysics=!0:this.doPhysics=!1;for(var b=0,c=this.meshes.length;b<c;b++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[b],a)},updateIKParametersDependingOnPhysicsEnabled:function(a,b){for(var c=a.geometry.iks,d=a.geometry.bones,e=0,f=c.length;e<f;e++)for(var g=c[e],h=g.links,i=0,j=h.length;i<j;i++){var k=h[i];b===!0?k.enabled=!(d[k.index].rigidBodyType>0):k.enabled=!0}},setAnimations:function(){for(var a=0;a<this.meshes.length;a++)this.setAnimation(this.meshes[a])},setAnimation:function(a){if(void 0!==a.geometry.animations){a.mixer=new THREE.AnimationMixer(a),a.mixer.addEventListener("loop",function(a){if(0===a.action._clip.tracks[0].name.indexOf(".bones")){var b=a.target._root;b.looped=!0}});for(var b=!1,c=!1,d=0;d<a.geometry.animations.length;d++){var e=a.geometry.animations[d],f=a.mixer.clipAction(e);0===e.tracks[0].name.indexOf(".morphTargetInfluences")?c||(f.play(),c=!0):b||(f.play(),b=!0)}b&&(a.ikSolver=new THREE.CCDIKSolver(a),void 0!==a.geometry.grants&&(a.grantSolver=new THREE.MMDGrantSolver(a)))}},TYsetAnimation:function(a){void 0!==a.geometry.animations&&(a.mixer=new THREE.AnimationMixer(a),a.mixer.addEventListener("loop",function(a){if(0===a.action._clip.tracks[0].name.indexOf(".bones")){var b=a.target._root;b.looped=!0}}))},TYsetikSolver:function(a){a.ikSolver=new THREE.CCDIKSolver(a),void 0!==a.geometry.grants&&(a.grantSolver=new THREE.MMDGrantSolver(a))},TYplayAction:function(a,b,c){var d=a.mixer.clipAction(b);return d.setEffectiveWeight(c),d.play(),d},TYgotoAndPlayAction:function(a,b,c,d){var e=a.mixer.clipAction(b);return e.setEffectiveWeight(c),e.time=.5*b.duration*d*.01,e.play(),e},TYgotoAndStopAction:function(a,b,c,d){var e=a.mixer.clipAction(b);e.paused=!0;var f=.5*b.duration*d*.01;return 0==f?(0!=e.time&&(e.time=0),e.isScheduled()&&a.mixer._deactivateAction(e)):(e.isScheduled()||a.mixer._activateAction(e),e.time!=f&&(e.time=f)),e},TYfadeToAction:function(a,b,c,d,e){var f=this;if(this.currentAction!=a.mixer.clipAction(b)){var g=this.TYgotoAndPlayAction(a,b,d,e);if(!this.currentAction)return void(this.currentAction=g);this.currentAction.crossFadeTo(g,c,!1),setTimeout(function(){f.currentAction.stop(),f.currentAction=g},1e3*c)}},TYfadeToStopAction:function(a,b,c,d,e){var f=this;if(this.currentAction!=a.mixer.clipAction(b)){var g=this.TYgotoAndStopAction(a,b,d,e);if(!this.currentAction)return void(this.currentAction=g);this.currentAction.crossFadeTo(g,c,!1),setTimeout(function(){f.currentAction.stop(),f.currentAction=g},1e3*c)}},setCameraAnimation:function(a){void 0!==a.animations&&(a.mixer=new THREE.AnimationMixer(a),a.mixer.clipAction(a.animations[0]).play())},unifyAnimationDuration:function(a){a=void 0===a?{}:a;for(var b=0,c=this.camera,d=this.audioManager,e=0;e<this.meshes.length;e++){var f=this.meshes[e],g=f.mixer;if(null!==g)for(var h=0;h<g._actions.length;h++){var i=g._actions[h];b=Math.max(b,i._clip.duration)}}if(null!==c&&null!==c.mixer)for(var g=c.mixer,e=0;e<g._actions.length;e++){var i=g._actions[e];b=Math.max(b,i._clip.duration)}null!==d&&(b=Math.max(b,d.duration)),void 0!==a.afterglow&&(b+=a.afterglow);for(var e=0;e<this.meshes.length;e++){var f=this.meshes[e],g=f.mixer;if(null!==g)for(var h=0;h<g._actions.length;h++){var i=g._actions[h];i._clip.duration=b}}if(null!==c&&null!==c.mixer)for(var g=c.mixer,e=0;e<g._actions.length;e++){var i=g._actions[e];i._clip.duration=b}null!==d&&(d.duration=b)},controlAudio:function(a){null!==this.audioManager&&this.audioManager.control(a)},animate:function(a){this.controlAudio(a);for(var b=0;b<this.meshes.length;b++)this.animateOneMesh(a,this.meshes[b]);this.sharedPhysics&&this.updateSharedPhysics(a),void 0!==this.physicsHelper&&this.physicsHelper.visible&&this.physicsHelper.update(),void 0!==this.ikHelper&&this.ikHelper.visible&&this.ikHelper.update()},animateOneMesh:function(a,b){var c=b.mixer,d=b.ikSolver,e=b.grantSolver,f=b.physics;null!==c&&this.doAnimation===!0&&(this.restoreBones(b),c.update(a),this.backupBones(b)),null!==d&&this.doIk===!0&&d.update(),null!==e&&this.doGrant===!0&&e.update(),b.looped===!0&&(null!==f&&f.reset(),b.looped=!1),null!==f&&this.doPhysics&&!this.sharedPhysics&&f.update(a)},updateSharedPhysics:function(a){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var b=this.getMasterPhysics();if(null!==b){for(var c=0,d=this.meshes.length;c<d;c++){var e=this.meshes[c].physics;null!==e&&void 0!==e&&e.updateRigidBodies()}b.stepSimulation(a);for(var c=0,d=this.meshes.length;c<d;c++){var e=this.meshes[c].physics;null!==e&&void 0!==e&&e.updateBones()}}}},animateCamera:function(a){if(null!==this.camera){var b=this.camera.mixer;null!==b&&void 0!==this.camera.center&&this.doCameraAnimation===!0&&(b.update(a),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(a,b,c){void 0===c&&(c={}),c.preventResetPose!==!0&&a.pose();for(var d=a.skeleton.bones,e=b.bones,f={},g=0;g<d.length;g++)f[d[g].name]=g;for(var h=new THREE.Vector3,i=new THREE.Quaternion,g=0;g<e.length;g++){var j=e[g],k=f[j.name];if(void 0!==k){var l=d[k],m=j.translation,n=j.quaternion;h.set(m[0],m[1],m[2]),i.set(n[0],n[1],n[2],n[3]),l.position.add(h),l.quaternion.multiply(i)}}if(a.updateMatrixWorld(!0),c.preventIk!==!0){var o=new THREE.CCDIKSolver(a);o.update(c.saveOriginalBonesBeforeIK)}if(c.preventGrant!==!0&&void 0!==a.geometry.grants){var o=new THREE.MMDGrantSolver(a);o.update()}},initBackupBones:function(a){a.skeleton.backupBones=[];for(var b=0;b<a.skeleton.bones.length;b++)a.skeleton.backupBones.push(a.skeleton.bones[b].clone())},backupBones:function(a){a.skeleton.backupBoneIsSaved=!0;for(var b=0;b<a.skeleton.bones.length;b++){var c=a.skeleton.backupBones[b],d=a.skeleton.bones[b];c.position.copy(d.position),c.quaternion.copy(d.quaternion)}},restoreBones:function(a){if(a.skeleton.backupBoneIsSaved===!0){a.skeleton.backupBoneIsSaved=!1;for(var b=0;b<a.skeleton.bones.length;b++){var c=a.skeleton.bones[b],d=a.skeleton.backupBones[b];c.position.copy(d.position),c.quaternion.copy(d.quaternion)}}}}),TY.AvatarControler=function(a){function b(){for(var a in c.mesh.morphTargetDictionary)for(var b=0;b<=TY.morphConifg.length;b++)a==TY.morphConifg[b]&&c.Keys.push(b);console.log(c.Keys)}var c=this;this.avatar=a,this.mesh=a.mesh,this.Keys=[],b(),this.testMorphNum=0,this.cunMorphsObj={};for(var d=0;d<TY.morphConifg.length;++d)this.cunMorphsObj[d]=0;this.cunMorphsOtherData=[100,100,100],this.cunMorphsOtherObj=TY.toObject(this.cunMorphsOtherData)},TY.AvatarControler.prototype=Object.assign(TY.EventDispatcher.prototype,{constructor:TY.AvatarControler,updateMorph:function(){this.testMorphNum>=TY.datas.length&&(this.testMorphNum=0),this.setMorph(TY.datas[this.testMorphNum]),this.setMorphOther(TY.datas[this.testMorphNum]),TY.logBox&&(TY.logBox.innerHTML=JSON.stringify(TY.datas[this.testMorphNum])+"<br>"),this.testMorphNum++},logMorphString:function(){var a="",b=0;for(var c in this.mesh.morphTargetDictionary)a+=b+":"+c+"  ",b++;console.log(a)},setMorph:function(a){for(var b=this,c={},d=0;d<TY.morphConifg.length;d++)a[d]?c[d]=a[d]:c[d]=0;new TWEEN.Tween(b.cunMorphsObj).to(c,300).start().onUpdate(function(){for(var a=0;a<TY.morphConifg.length;a++)0!=this[a]&&(b.mesh.morphTargetInfluences[a]=.01*this[a])})},setMorphOther:function(a){for(var b=this,c={},d=0;d<b.cunMorphsOtherData.length;d++){var e=TY.morphConifg.length+d;a[e]?c[d]=a[e]:c[d]=100}new TWEEN.Tween(b.cunMorphsOtherObj).to(c,300).start().onUpdate(function(){for(var a=0;a<b.cunMorphsOtherData.length;a++)a<b.mesh.geometry.animations.length&&b.avatar.TYgotoAndStopAction(b.mesh,b.mesh.geometry.animations[a],1,this[a])})}}),TY.Gui=function(a){function b(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=new THREE.MeshPhongMaterial;e.copy(a[c]),e.needsUpdate=!0,b.push(e)}h=new THREE.MultiMaterial(b)}function c(){for(var a in l)m[a]=0}function d(){for(var a in l)n.push(a)}function e(){for(var a in l)o.add(m,a,0,1,.01).onChange(f)}function f(){for(var a=0;a<n.length;a++){var b=n[a],c=m[b];j.morphTargetInfluences[a]=c}}function g(){var c={animation:!0,"gradient mapping":!0,ik:!0,outline:!0,physics:!0,"show IK bones":!1,"show rigid bodies":!1};k.add(c,"animation").onChange(function(){a.doAnimation=c.animation}),k.add(c,"gradient mapping").onChange(function(){void 0===i&&(i=j.material),void 0===h&&b(j.material.materials),c["gradient mapping"]?j.material=i:j.material=h}),k.add(c,"ik").onChange(function(){a.doIk=c.ik}),k.add(c,"outline").onChange(function(){TY.effect.enabled=c.outline}),k.add(c,"physics").onChange(function(){a.enablePhysics(c.physics)}),k.add(c,"show IK bones").onChange(function(){a.ikHelper.visible=c["show IK bones"]}),k.add(c,"show rigid bodies").onChange(function(){void 0!==a.physicsHelper&&(a.physicsHelper.visible=c["show rigid bodies"])})}var h,i,j=a.mesh,k=new dat.GUI,l=j.morphTargetDictionary,m={},n=[],o=k.addFolder("Morphs");c(),d(),e(),g(),f(),o.close(),k.close()},TY.Gui.prototype=Object.assign(TY.EventDispatcher.prototype,{constructor:TY.Gui});var container,stats,loading,mesh,camera,scene,renderer,sky,avatar,player,clock=new THREE.Clock;init(),animate();